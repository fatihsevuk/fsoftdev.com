I"ô<h2 id="baÅŸlangÄ±Ã§">BaÅŸlangÄ±Ã§</h2>

<p>Merhabalar bu yazÄ±mÄ±zda Spring Boot ve MySQL veri tabanÄ± kullanarak geliÅŸtirdiÄŸimiz bir uygulamayÄ± nasÄ±l Container iÃ§erisine alÄ±p Ã§alÄ±ÅŸtÄ±rabileceÄŸimizi Ã¶ÄŸreneceÄŸiz.YapacaÄŸÄ±mÄ±z iÅŸlemleri kuÅŸ bakÄ±ÅŸoÄ± senarize edecek olursak ilk olarak MySQL Imageâ€™den Container oluÅŸturuyoruz.Daha sonra Sprin Boot uygulamamÄ±zÄ± Containerize ediyoruz.Tabi ki Spring Boot Containerâ€™ Ä±mÄ±z MySQL Containerâ€™Ä±mÄ±z ile entegre ediliyor.Åimdi gelin bu adÄ±mlarÄ± hep beraber yapalÄ±m.</p>

<h2 id="mysql-container-oluÅŸturma">MySQL Container OluÅŸturma</h2>

<p>Ä°lk olarak <code class="highlighter-rouge">docker run mysql:5.7</code> komutunu terminale yazÄ±p Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±mÄ±zda neler oluyor bir bakalÄ±m.Bu komut lokalde MySQL Imageâ€™ini arar ve Ã§alÄ±ÅŸtÄ±rÄ±r eÄŸer bulamazsa Docker Hub dan Ã¶nce MySQL Imageâ€™ini Ã§eker ve Ã§alÄ±ÅŸtÄ±rÄ±r.Bu komut ÅŸÃ¶yle bir error Ã¼retir;</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>2020-03-22 19:34:13+00:00 [ERROR] [Entrypoint]: Database is uninitialized and password option is not specified
	You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD

</pre></td></tr></tbody></table></code></pre></div></div>

<p>Bu hata veri tabanÄ± iÃ§in Root parolasÄ± tanÄ±mlamamÄ±zÄ± sÃ¶ylÃ¼yor bunu ÅŸu keilde yapacaÄŸÄ±z.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>docker run <span class="nt">-d</span> <span class="nt">-e</span> <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>dummyrootpw <span class="nt">-e</span> <span class="nv">MYSQL_DATABASE</span><span class="o">=</span>students <span class="nt">-e</span> <span class="nv">MYSQL_PASSWORD</span><span class="o">=</span>dummyuserpw <span class="nt">-e</span> <span class="nv">MYSQL_USER</span><span class="o">=</span>dummyuser <span class="nt">-p</span> 3306:3306 <span class="nt">--name</span> mysql mysql:5.7
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Evet bu komutu hatasÄ±z girdiÄŸimizde oluÅŸan Containeâ€™Ä±n idsi ekrana basÄ±lÄ±r.AynÄ± zamanda <code class="highlighter-rouge">container ls</code> komutu ile Containerâ€™Ä±mÄ±zÄ±n Ã§alÄ±ÅŸÄ±p Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ± kontrol edebiliriz.</p>

<p>Evet ÅŸuanda Ã§alÄ±ÅŸan bir MySQL veri tabanÄ±na sahibiz bu veritabanÄ±na ister lokalde herhangi bir uygulamamÄ±zÄ± isterse Container iÃ§erisinde herhangi bir uygulamayÄ± baÄŸlayabiliriz. Biz containerize edeceÄŸimiz bir Spring Boot uygulamasÄ±nÄ± baÄŸlayacaÄŸÄ±z.</p>

<h2 id="spring-boot-container-oluÅŸturma">Spring Boot Container OluÅŸturma</h2>

<p>MySQL Container oluÅŸtururken environment olarak ayarladÄ±ÄŸÄ±mÄ±z <code class="highlighter-rouge">MYSQL_DATABASE</code> , <code class="highlighter-rouge">MYSQL_USER</code> ve <code class="highlighter-rouge">MYSQL_PASSWORD</code> deÄŸerlerini Spring uygulamamÄ±z iÃ§erisindeki <code class="highlighter-rouge">application.properties</code> dosyasÄ± iÃ§erisine aÅŸaÄŸÄ±daki gibi yazmamÄ±z gerekiyor.</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="py">spring.datasource.driver-class-name</span><span class="p">=</span><span class="s">com.mysql.cj.jdbc.Driver</span>
<span class="py">spring.jpa.hibernate.ddl-auto</span><span class="p">=</span><span class="s">update</span>
<span class="py">spring.datasource.url</span><span class="p">=</span><span class="s">jdbc:mysql://${RDS_HOSTNAME:localhost}:${RDS_PORT:3306}/${RDS_DB_NAME:students}</span>
<span class="py">spring.datasource.username</span><span class="p">=</span><span class="s">${RDS_USERNAME:dummyuser}</span>
<span class="py">spring.datasource.password</span><span class="p">=</span><span class="s">${RDS_PASSWORD:dummyuserpw}</span>
<span class="py">spring.jpa.properties.hibernate.dialect</span><span class="p">=</span><span class="s">org.hibernate.dialect.MySQL57Dialect</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>UygulamamÄ±z iÃ§erisinde veri tabanÄ±na baÄŸlanmak iÃ§in gerekli ayarlamalarÄ± yaptÄ±ktan sonra uygulamamÄ±zÄ± Container olarak yaÄŸa kaldÄ±rabiliriz.Bunun iÃ§in daha Ã¶nceki yazÄ±larda bahsettiÄŸimiz <code class="highlighter-rouge">Spotify Dockerfile Plugin</code> kullanacaÄŸÄ±z.</p>

<p>Dockerfile iÃ§eriÄŸimiz aÅŸaÄŸÄ±daki gibidir.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>FROM tomcat:8.0.51-jre8-alpine
RUN rm -rf /usr/local/tomcat/webapps/*
COPY ./target/*.war /usr/local/tomcat/webapps/ROOT.war
CMD ["catalina.sh","run"]
</pre></td></tr></tbody></table></code></pre></div></div>
<p><code class="highlighter-rouge">mvn clean package -DskipTests</code> komutunu Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±mÄ±zda uygulama klasÃ¶rÃ¼ altÄ±nda ki target dizini altÄ±na .war arÅŸivimiz oluÅŸur ve Image iÃ§erisine kopyalanÄ±r.</p>

<p>Evet Spring Boot uygulamamÄ±zÄ± iÃ§eren Imageâ€™imiz hazÄ±r aynÄ± zamanda MySQL Containerâ€™Ä±mÄ±zda Ã§alÄ±ÅŸÄ±r durumda geriye ikisi arasÄ±ndaki baÄŸlantÄ±yÄ± saÄŸlamak kaldÄ±.Bunun iÃ§in uygulama Imageâ€™Ä±mÄ±zÄ± aÅŸaÄŸÄ±daki ÅŸekilde run etmemiz gerekir.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>docker container run -p 8080:8080 --link=mysql -e RDS_HOSTNAME=mysql spring-mysql-app:1.0.0-SNAPSHOT
</pre></td></tr></tbody></table></code></pre></div></div>

<p>yukarÄ±daki komutta <code class="highlighter-rouge">--link mysql</code> parametresi ile spring uygulamamÄ±zÄ± mysql ile baÄŸlÄ±yoruz. <code class="highlighter-rouge">--link</code> baÄŸlayacaÄŸÄ±mÄ±z Containerâ€™Ä±n adÄ±nÄ± parametre alÄ±r.Fakat <code class="highlighter-rouge">--link</code> deprecated
bir parametredir.Bunun yerine Docker network yapÄ±larÄ±nÄ± kullanacaÄŸÄ±z.Åimdilik â€“link ile yapalÄ±m.</p>

<p><code class="highlighter-rouge">-e RDS_HOSTNAME=mysql</code> komutu da aÄŸ Ã¼zerindeki mysql veritabanÄ±na baÄŸlanmak iÃ§in gereklidir.</p>

:ET